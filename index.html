<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RGC Pensiones - Calculadora de Proyección</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --dark-blue: #003366; /* Azul marino profundo */
            --gold: #D4AF37;     /* Oro metálico */
            --dark-gold: #B8860B; /* Oro oscuro para hover */
            --text-dark: #1A202C;  /* Casi negro */
            --text-medium: #4A5568;/* Gris oscuro */
            --bg-light: #F8F9FA;  /* Gris muy claro */
            --white: #FFFFFF;
            --border-color: #E2E8F0;
            --success-color: #16A34A;
            --danger-color: #DC2626;
        }

        body { 
            font-family: 'Lato', sans-serif; 
            background-color: var(--bg-light);
            color: var(--text-medium);
        }
        
        /* Encabezado Principal */
        .main-header {
            background: linear-gradient(135deg, var(--dark-blue) 0%, #002244 100%);
            color: var(--white);
            padding: 2.5rem 1rem;
            text-align: center;
            border-radius: 0 0 40px 40px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 3rem;
        }
        .logo-text-elegant {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            font-size: 2.5rem;
            color: var(--gold);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
            letter-spacing: 1px;
        }
        .main-header .logo-text-elegant {
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        .main-header h1 {
            font-family: 'Lato', sans-serif;
            font-weight: 900;
            font-size: 2.25rem; /* 36px */
            letter-spacing: -0.5px;
        }
        .main-header p {
            font-size: 1.125rem; /* 18px */
            opacity: 0.85;
            font-weight: 400;
        }

        /* Estructura de Secciones */
        .infographic-section {
            background-color: var(--white);
            border-radius: 20px;
            padding: 2rem 2.5rem;
            margin-bottom: 2.5rem;
            box-shadow: 0 8px 30px rgba(0, 51, 102, 0.08);
            border: 1px solid var(--border-color);
            border-top: 6px solid var(--dark-blue);
        }
        .infographic-section h2 {
            font-family: 'Lato', sans-serif;
            font-weight: 900;
            font-size: 1.75rem; /* 28px */
            margin-bottom: 2rem;
            color: var(--dark-blue);
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }
        .infographic-section h2 i {
            margin-right: 1rem;
            font-size: 1.5rem;
            color: var(--gold);
        }
        .infographic-section h3.subsection-title {
            font-family: 'Lato', sans-serif;
            font-weight: 700;
            font-size: 1.25rem; /* 20px */
            color: var(--dark-blue);
            margin-top: 2rem;
            margin-bottom: 1.5rem;
        }
        
        /* Formularios y Entradas */
        .input-group label {
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--text-medium); 
            font-size: 0.875rem; /* 14px */
            display: block;
        }
        .input-group input[type="text"],
        .input-group input[type="password"],
        .input-group input[type="number"],
        .input-group input[type="month"],
        .input-group input[type="date"],
        .input-group select,
        .input-group textarea {
            padding: 0.8rem 1rem;
            border: 1px solid #CBD5E0;
            border-radius: 0.5rem; /* 8px */
            font-size: 1rem;
            width: 100%;
            transition: all 0.2s ease-in-out;
            background-color: #FDFDFD;
        }
        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            border-color: var(--gold); 
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
            outline: none;
        }
        .input-group input[readonly] {
            background-color: #E9ECEF;
            cursor: not-allowed;
        }
        
        /* Botones */
        .btn {
            font-family: 'Lato', sans-serif;
            font-weight: 700;
            padding: 0.8rem 2rem;
            border-radius: 0.5rem;
            transition: all 0.25s ease-out;
            border: none;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .btn:disabled {
            background: #A0AEC0;
            color: #E2E8F0;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        
        .btn-gold {
            background: linear-gradient(135deg, var(--gold), var(--dark-gold));
            color: var(--dark-blue);
        }
        .btn-gold:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(212, 175, 55, 0.3);
        }

        .btn-blue {
            background: linear-gradient(135deg, var(--dark-blue), #004488);
            color: var(--white);
        }
        .btn-blue:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 51, 102, 0.3);
        }
        
        .btn-secondary {
            background-color: var(--white);
            color: var(--dark-blue);
            border: 2px solid var(--dark-blue);
            padding: 0.7rem 1.5rem;
        }
        .btn-secondary:hover:not(:disabled) {
            background-color: var(--dark-blue);
            color: var(--white);
        }
        
        .btn-danger-icon {
            background-color: #FFF1F2;
            color: #E53E3E;
            border: 1px solid #E53E3E;
            padding: 0.5rem;
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }
        .btn-danger-icon:hover {
            background-color: #E53E3E;
            color: var(--white);
        }
        
        /* Employment Card Styles */
        .employment-card {
            background-color: #F8F9FA;
            border: 1px solid #E2E8F0;
            border-left: 5px solid var(--dark-blue);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
        }
        
        /* Login Container */
        #loginContainer {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--bg-light);
            z-index: 40;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            pointer-events: none;
        }
        #loginContainer.active {
            opacity: 1;
            pointer-events: auto;
        }

        .login-box {
            background-color: var(--white);
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 51, 102, 0.15);
            width: 100%;
            max-width: 450px;
            border-top: 6px solid var(--gold);
        }
        .login-box h2 {
            font-family: 'Lato', sans-serif;
            font-weight: 900;
            font-size: 2rem;
            color: var(--dark-blue);
            text-align: center;
            margin-bottom: 2.5rem;
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 34, 68, 0.7); /* Azul oscuro semi-transparente */
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        .modal-content {
            background-color: var(--white);
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 51, 102, 0.2);
            max-width: 90%;
            width: 650px;
            border-top: 6px solid var(--gold);
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }
        
        .modal-content-alert {
             text-align: center;
             width: 400px;
        }
        
        .modal-content h2 {
             font-family: 'Lato', sans-serif;
             color: var(--dark-blue);
             font-size: 1.5rem;
             font-weight: 700;
             text-align: center;
             margin-bottom: 1.5rem;
             padding-bottom: 1rem;
             border-bottom: 1px solid var(--border-color);
        }
        .privacy-text-container {
            border: 1px solid var(--border-color);
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            background-color: var(--bg-light);
            max-height: 55vh;
            overflow-y: auto;
            margin-bottom: 1.5rem;
        }
        .privacy-text-container p {
            font-size: 0.875rem; /* 14px */
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        .privacy-text-container::-webkit-scrollbar { width: 8px; }
        .privacy-text-container::-webkit-scrollbar-track { background: var(--border-color); border-radius: 10px; }
        .privacy-text-container::-webkit-scrollbar-thumb { background-color: var(--gold); border-radius: 10px; }

        .app-footer {
            text-align: center;
            margin-top: 4rem;
            padding: 2.5rem 1rem;
            background-color: var(--dark-blue);
            color: var(--white);
            border-radius: 40px 40px 0 0;
        }
        .app-footer .logo-text-footer {
            font-family: 'Playfair Display', serif;
            color: var(--gold);
            font-weight: 700;
            font-size: 1.25rem;
            margin-bottom: 1rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        .app-footer p { opacity: 0.8; }

        #sessionTimerContainer {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-family: 'Lato', sans-serif;
            font-weight: 700;
            color: var(--text-dark);
            z-index: 100;
            transition: color 0.3s;
        }

        /* Menu Styles */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }
        .menu-card {
            background: var(--white);
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 8px 30px rgba(0, 51, 102, 0.08);
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        .menu-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(0, 51, 102, 0.12);
        }
        .menu-card i {
            font-size: 3rem;
            color: var(--gold);
            margin-bottom: 1.5rem;
        }
        .menu-card h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--dark-blue);
            margin-bottom: 0.5rem;
        }
        .menu-card p {
            font-size: 0.875rem;
            color: var(--text-medium);
        }

        /* D3 Timeline Tooltip Styles */
        #timeline-tooltip {
            position: absolute;
            text-align: left;
            padding: 8px 12px;
            font-size: 12px;
            background: #2d3748;
            color: white;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 10;
        }

        /* Admin Advisor Toggle Switch */
        .switch {
          position: relative;
          display: inline-block;
          width: 60px;
          height: 34px;
        }
        .switch input { 
          opacity: 0;
          width: 0;
          height: 0;
        }
        .slider {
          position: absolute;
          cursor: pointer;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: #ccc;
          transition: .4s;
          border-radius: 34px;
        }
        .slider:before {
          position: absolute;
          content: "";
          height: 26px;
          width: 26px;
          left: 4px;
          bottom: 4px;
          background-color: white;
          transition: .4s;
          border-radius: 50%;
        }
        input:checked + .slider {
          background-color: var(--dark-blue);
        }
        input:checked + .slider:before {
          transform: translateX(26px);
        }
    </style>
</head>
<body>
    
    <div id="confidentialityModal" class="modal-overlay">
        <div class="modal-content">
            <h2>CARTA COMPROMISO DE CONFIDENCIALIDAD</h2>
            <div class="privacy-text-container">
                 <p><strong>Fecha:</strong> <span id="agreementDate"></span><br><strong>Lugar:</strong> Ciudad de México, México</p>
                 <p>En mi calidad de Asesor para RGC Pensiones y Seguros, manifiesto y acepto de manera voluntaria los siguientes términos y condiciones:</p>
                 <p><strong>1. ANTECEDENTES</strong><br>Reconozco que, en virtud de mi relación profesional con RGC Pensiones, se me ha proporcionado acceso a una herramienta de software especializada (en adelante, "la Herramienta"), la cual es fundamental para el desempeño de mis funciones.</p>
                 <p><strong>2. PROPIEDAD INTELECTUAL</strong><br>Declaro tener pleno conocimiento de que la Herramienta es propiedad intelectual exclusiva del C. Ivan Roberto Ortiz Cano, y que RGC Pensiones cuenta con la licencia y autorización para su uso con fines corporativos específicos. Entiendo que mi acceso a la misma es una concesión temporal y está estrictamente limitado al ejercicio de mis responsabilidades dentro de esta empresa.</p>
                 <p><strong>3. COMPROMISO DE USO EXCLUSIVO</strong><br>Me comprometo de manera irrevocable a utilizar la Herramienta única y exclusivamente para los fines y objetivos de negocio de RGC Pensiones. Me doy por enterado de que existe un límite de dos (2) descargas de reportes en formato PDF por cada inicio de sesión.</p>
                 <p><strong>4. PROHIBICIONES ESPECÍFICAS</strong><br>Queda estrictamente prohibido y me obligo a abstenerme de:<br>
                 a) Utilizar la Herramienta, sus funciones, datos, metodologías o resultados para obtener cualquier tipo de lucro o beneficio personal, directo o indirecto.<br>
                 b) Emplear la Herramienta para prestar servicios, asesorías o realizar actividades para terceros, ya sean personas físicas o morales, ajenos a RGC Pensiones.<br>
                 c) Copiar, reproducir, modificar, distribuir, vender, sublicenciar, descompilar o realizar ingeniería inversa de la Herramienta o cualquiera de sus componentes.<br>
                 d) Compartir mis credenciales de acceso (contraseña o cualquier otra forma de acceso) con cualquier otra persona, dentro o fuera de la organización.<br>
                 e) Utilizar la Herramienta fuera de las instalaciones y oficinas de RGC Pensiones.</p>
                 <p><strong>5. CONSECUENCIAS DEL INCUMPLIMIENTO</strong><br>Entiendo y acepto que el incumplimiento de cualquiera de los puntos estipulados en esta carta será considerado una falta grave y se podrá dar lugar a:<br>
                 a) Concluir la relación profesional y comercial con RGC Pensiones, sin responsabilidad para la empresa.<br>
                 b) El inicio de acciones legales en mi contra por parte de RGC Pensiones y/o del Sr. Ivan Roberto Ortiz Cano, titular de la propiedad intelectual, para reclamar la reparación de los daños y perjuicios ocasionados.</p>
                 <p>Este compromiso mantendrá su vigencia durante toda mi relación con RGC Pensiones y subsistirá incluso después de su terminación, por tiempo indefinido.</p>
                 <p>Habiendo leído y comprendido en su totalidad el presente documento, lo acepto de conformidad.</p>
            </div>
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <input type="checkbox" id="agreementCheckbox" class="h-5 w-5 text-blue-600 border-gray-400 rounded focus:ring-gold-500">
                    <label for="agreementCheckbox" class="ml-3 block text-sm text-gray-700 font-medium">
                        He leído, comprendido y acepto los términos.
                    </label>
                </div>
                <button id="acceptAgreementButton" onclick="acceptAgreement()" class="btn btn-gold" disabled>
                    Aceptar y Continuar
                </button>
            </div>
        </div>
    </div>

    <div id="sessionTimerContainer" style="display: none;">
        <i class="fas fa-clock mr-2"></i>Tiempo restante: <span id="sessionCountdown">15:00</span>
    </div>

    
    <div id="loginContainer">
        <div class="login-box">
            <div class="logo-text-elegant text-center mb-8">RGC Pensiones y Seguros</div>
            <h2>Acceso de Asesor</h2>
            <div class="input-group mb-4">
                <label for="login_asesor"><i class="fas fa-user-tie mr-2 opacity-70"></i>Usuario:</label>
                <input type="text" id="login_asesor" placeholder="Usuario" class="w-full">
            </div>
            <div class="input-group">
                <label for="login_password"><i class="fas fa-lock mr-2 opacity-70"></i>Contraseña:</label>
                <input type="password" id="login_password" placeholder="••••••••••" class="w-full">
            </div>
            <div class="text-center mt-8">
                <button id="loginButton" onclick="handleLogin()" class="btn btn-blue w-full">
                    <i class="fas fa-sign-in-alt"></i>Ingresar
                </button>
            </div>
            <div id="login_errorMessage" class="error-message-infographic" style="display: none; margin-top: 1.5rem;"><p></p></div>
        </div>
    </div>

    
    <div id="appContainer" class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-6xl" style="display: none;">
        
        <div id="vigenciaAlertContainer" class="hidden mb-6"></div>
        
        <div id="mainMenuSection">
            <header class="main-header">
                <div class="logo-text-elegant">RGC Pensiones y Seguros</div>
                <h1>Panel de Asesor</h1>
                <p>Selecciona una herramienta para comenzar.</p>
                <p id="asesorNameDisplay" class="text-lg font-semibold mt-2 opacity-90"></p>
            </header>
            <div class="menu-grid">
                <div class="menu-card" id="menuCardCalculator" onclick="showSection('calculatorSection')">
                    <i class="fas fa-calculator"></i>
                    <h3>Cálculo de Pensión y Crédito</h3>
                    <p>Realiza proyecciones detalladas de pensión y financiamiento para clientes.</p>
                </div>
                <div class="menu-card" id="menuCardContract" onclick="showSection('contractSection')" style="display: none;">
                    <i class="fas fa-pencil-alt"></i>
                    <h3>Realizar Contrato</h3>
                    <p>Módulo para la generación de contratos.</p>
                </div>
                <div class="menu-card" id="menuCardCrm" onclick="showSection('crmSection')" style="display: none;">
                    <i class="fas fa-users"></i>
                    <h3>Cartera de Clientes</h3>
                    <p>Gestiona y consulta la información de tus clientes.</p>
                </div>
                <div id="adminMenuCard" class="menu-card md:col-span-2" onclick="showSection('adminSection')" style="display: none;">
                    <i class="fas fa-user-shield"></i>
                    <h3>Panel de Administrador</h3>
                    <p>Ver registros de actividad y gestionar asesores.</p>
                </div>
            </div>
        </div>

        
        <div id="calculatorSection" style="display: none;">
            <button onclick="showSection('mainMenuSection')" class="btn btn-secondary mb-6"><i class="fas fa-arrow-left mr-2"></i>Volver al Menú</button>
            
            <section id="infoSection1" class="infographic-section">
                <h2><i class="fas fa-user-edit"></i>Paso 1: Datos y Análisis de Historial</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-x-12 gap-y-8">
                    <div>
                        <h3 class="subsection-title !mt-0">Datos del Cliente</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 mb-8">
                            <div class="input-group">
                                <label for="info_nombreCompleto">Nombre Completo (Apellidos Nombre):</label>
                                <input type="text" id="info_nombreCompleto" placeholder="Se llena automático o manual" class="w-full">
                            </div>
                            <div class="input-group">
                                <label for="info_curpCliente">CURP:</label>
                                <input type="text" id="info_curpCliente" placeholder="Se llena automático o manual" maxlength="18" oninput="this.value = this.value.toUpperCase();" class="w-full">
                            </div>
                             <div class="input-group">
                                 <label for="info_telefonoCliente">Teléfono (10 dígitos):</label>
                                 <input type="text" id="info_telefonoCliente" placeholder="5512345678" maxlength="10" class="w-full">
                             </div>
                            <div class="input-group">
                                <label for="info_semanasTotalesManual">Semanas Totales Cotizadas:</label>
                                <input type="number" id="info_semanasTotalesManual" placeholder="Se llena automático o manual" class="w-full">
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="subsection-title !mt-0">Fuente de Datos del Historial</h3>
                        <div class="bg-blue-50 border border-blue-200 rounded-xl p-6 mb-6">
                             <div class="bg-yellow-50 border-l-4 border-yellow-400 text-yellow-700 p-4 rounded-md mb-6" role="alert">
                                 <p class="font-bold">¡Importante!</p>
                                 <p class="text-sm">Para el análisis automático, convierte el PDF de la constancia del IMSS a Word, copia todo el texto y pégalo abajo.</p>
                                 <a href="https://www.ilovepdf.com/es/pdf_a_word" target="_blank" class="btn btn-gold mt-4 text-sm !py-2">
                                     <i class="fas fa-file-word"></i> Ir al Conversor PDF a Word
                                 </a>
                             </div>

                        <div class="input-group">
                            <label for="info_textoCompleto">Pegue aquí el texto convertido:</label>
                            <textarea id="info_textoCompleto" class="w-full font-mono text-sm" rows="8" placeholder="Pegue todo el texto, desde el nombre del cliente hasta el último movimiento..."></textarea>
                        </div>
                        <div class="text-center mt-4">
                            <button onclick="analizarTextoCompleto()" class="btn btn-blue">
                                <i class="fas fa-magic"></i> Extraer y Analizar Texto
                            </button>
                        </div>
                        </div>
                        
                        <div>
                            <h3 class="subsection-title">... O ingrese los datos manualmente:</h3>
                             <div id="employmentCardsContainerWrapper">
                                 <button id="toggleCardsBtn" onclick="toggleAutoCards()" class="btn btn-secondary mb-4" style="display: none;">Mostrar/Ocultar Tarjetas Automáticas</button>
                                 <div id="employmentCardsContainer" style="display: none;"></div>
                             </div>
                            <button onclick="addEmploymentCard()" class="btn btn-secondary mt-4"><i class="fas fa-plus mr-2"></i>Agregar Empleo Manualmente</button>
                        </div>
                    </div>
                </div>


                <div id="sbcAnalysisResultsContainer" class="mt-12 pt-8 border-t" style="display: none;">
                    <h3 class="subsection-title">Resultados del Análisis</h3>
                    <div id="ageAdjustmentWarning" class="mb-4 p-3 rounded-lg text-sm bg-yellow-50 border border-yellow-200 text-yellow-800" style="display: none;"></div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-sm text-blue-800">SBC Promedio</p>
                            <p id="res_sbcPromedio" class="text-2xl font-bold text-blue-900">$0.00</p>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-sm text-blue-800">Edad Actual</p>
                            <p id="res_edadActual" class="text-2xl font-bold text-blue-900">0 años</p>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-sm text-blue-800">Teléfono</p>
                            <p id="res_telefonoCliente" class="text-2xl font-bold text-blue-900">--</p>
                        </div>
                        <div id="vigenciaResultBox" class="p-4 rounded-lg md:col-span-3">
                            <p id="vigenciaResultText" class="text-2xl font-bold">--</p>
                            <p id="vigenciaResultSubText" class="text-sm">--</p>
                        </div>
                    </div>
                     <div class="mt-6 overflow-x-auto">
                         <div class="flex justify-between items-center mb-2 flex-wrap gap-4">
                             <h4 class="font-semibold text-gray-700">Periodos del Historial Laboral</h4>
                             <div class="flex items-center space-x-4">
                                 <div class="flex items-center">
                                     <input type="checkbox" id="showFullHistoryCheckbox" onchange="renderSbcAnalysisTable()" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                     <label for="showFullHistoryCheckbox" class="ml-2 text-sm text-gray-600">Mostrar historial completo</label>
                                 </div>
                                 <div class="flex items-center">
                                     <input type="checkbox" id="showSbcBreakdownCheckbox" onchange="renderSbcAnalysisTable()" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                     <label for="showSbcBreakdownCheckbox" class="ml-2 text-sm text-gray-600">Desglose por empleador</label>
                                 </div>
                             </div>
                         </div>
                        <table class="w-full text-sm text-left">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="p-2">Registro Patronal</th>
                                    <th class="p-2">Fecha Inicio</th>
                                    <th class="p-2">Fecha Fin</th>
                                    <th class="p-2 text-right">Días</th>
                                    <th class="p-2 text-right">SBC Diario</th>
                                    <th class="p-2 text-right">SBC Ponderado (para cálculo)</th>
                                </tr>
                            </thead>
                            <tbody id="sbcAnalysisTableBody">
                            </tbody>
                            <tfoot id="sbcAnalysisTableFooter" class="font-bold bg-gray-100">
                            </tfoot>
                        </table>
                         <div id="sbcDaysWarning" class="mt-4 p-3 rounded-lg text-sm" style="display: none;"></div>
                         <div id="modalitySummaryContainer" class="mt-6"></div>
                    </div>
                </div>

                <div id="timelineSection" class="mt-12 pt-8 border-t" style="display: none;">
                    <h3 class="subsection-title">Línea de Tiempo del Historial Laboral (Últimos 10 Años)</h3>
                    <div id="timeline-container" class="w-full h-96 overflow-x-auto"><svg id="timeline-svg"></svg></div>
                    <div id="timeline-legend" class="flex flex-wrap gap-x-4 gap-y-2 mt-4 p-2 border-t"></div>
                </div>

                <div id="basePensionResultsContainer" class="mt-8" style="display: none;">
                    <h3 class="subsection-title">Resultados de Pensión Base (Sin M40)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                        <div class="bg-green-50 p-4 rounded-lg">
                            <p class="text-sm text-green-800">Pensión Mensual Estimada</p>
                            <p id="res_base_pensionMensual" class="text-2xl font-bold text-green-900">$0.00</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <p class="text-sm text-green-800">Aguinaldo Estimado</p>
                            <p id="res_base_aguinaldo" class="text-2xl font-bold text-green-900">$0.00</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <p class="text-sm text-green-800">Ingreso Anual Total</p>
                            <p id="res_base_ingresoAnual" class="text-2xl font-bold text-green-900">$0.00</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="infoSection2" class="infographic-section">
                <h2><i class="fas fa-chart-line"></i>Paso 2: Estrategia Modalidad 40</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                    <div>
                         <h3 class="subsection-title">Definir Periodo de Inversión en M40</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-6">
                            <div class="input-group">
                                <label for="info_m40_p1_inicio">Fecha Inicio M40:</label>
                                <input type="month" id="info_m40_p1_inicio" onchange="actualizarSBCMaximoM40(); actualizarFechaFinM40Display();" class="w-full">
                            </div>
                            <div class="input-group">
                                <label for="info_m40_p1_meses">Meses a Invertir:</label>
                                <input type="number" id="info_m40_p1_meses" placeholder="Ej: 60" max="60" oninput="actualizarFechaFinM40Display()" class="w-full">
                            </div>
                            <div class="input-group sm:col-span-2">
                                <label for="info_m40_p1_sbc">SBC Diario M40 (Tope):</label>
                                <input type="number" id="info_m40_p1_sbc" placeholder="Automático" class="w-full">
                            </div>
                        </div>
                         <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg text-center">
                             <div id="info_m40_baja_display" class="text-sm font-semibold text-blue-800 leading-relaxed">
                                 -- Ingrese fechas para ver la edad de baja --
                             </div>
                         </div>
                    </div>
                    <div>
                        <h3 class="subsection-title">Tabla de Referencia UMA</h3>
                        <div class="overflow-x-auto max-h-64">
                            <table class="w-full text-sm text-left">
                                <thead class="bg-gray-100 sticky top-0">
                                    <tr>
                                        <th class="p-2">Año</th>
                                        <th class="p-2 text-right">Valor UMA Diario</th>
                                        <th class="p-2 text-right">SBC Tope (25 UMAs)</th>
                                    </tr>
                                </thead>
                                <tbody id="umaReferenceTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-10">
                    <button id="btnCalcularEscenarioM40" onclick="calcularEscenarioM40Infografia()" class="btn btn-gold">
                        <i class="fas fa-cogs"></i>Calcular Proyección M40
                    </button>
                </div>
            </section>

            <section id="infoSection3" class="infographic-section" style="display: none;">
                <h2><i class="fas fa-hand-holding-usd"></i>Paso 3: Análisis Financiero</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                    <div class="input-group">
                        <label for="info_aforeActual">AFORE Actual ($):</label>
                        <input type="number" id="info_aforeActual" placeholder="0.00" oninput="recalculateAllScenarios();">
                    </div>
                    <div class="input-group">
                        <label for="info_mesesPrimerDeposito">Meses para Primer Depósito (6-12):</label>
                        <input type="number" id="info_mesesPrimerDeposito" value="6" min="6" max="12" onchange="handleMesesDepositoChange(this)" data-last-valid="6">
                    </div>
                     <div class="input-group md:col-span-2">
                         <label for="info_comisionExcedente">Comisión por Excedente ($) y Concepto:</label>
                         <div class="flex gap-4">
                             <input type="number" id="info_comisionExcedente" placeholder="0.00" oninput="recalculateAllScenarios();" class="w-1/2">
                             <input type="text" id="info_comisionExcedente_concepto" placeholder="Concepto para reporte" class="w-1/2">
                         </div>
                     </div>
                </div>
            </section>
            
            <section id="infoSection4" class="infographic-section" style="display: none;">
                <h2><i class="fas fa-balance-scale-right"></i>Paso 4: Comparador de Escenarios</h2>
                <div id="scenariosContainer" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    </div>
                 <div class="text-center mt-8">
                     <button id="addScenarioBtn" onclick="addScenarioCard()" class="btn btn-secondary"><i class="fas fa-plus mr-2"></i>Agregar Escenario</button>
                 </div>
            </section>

            <section id="infoSection5" class="infographic-section text-center" style="display: none;">
                <h2><i class="fas fa-file-export"></i>Paso 5: Exportar Reportes</h2>
                 <p class="mb-8 text-gray-600 text-lg max-w-2xl mx-auto">Genera reportes detallados en PDF.</p>
                <div class="flex justify-center flex-wrap gap-6">
                    <button onclick="promptForClientPDF()" class="btn btn-blue text-lg">
                        <i class="fas fa-user"></i> Reporte PDF para Cliente
                    </button>
                    <button onclick="promptForDirectorPDF()" class="btn btn-gold text-lg">
                        <i class="fas fa-user-shield"></i> Reporte PDF para Dirección
                    </button>
                </div>
            </section>
        </div>

        
        <div id="contractSection" style="display: none;">
            <button onclick="showSection('mainMenuSection')" class="btn btn-secondary mb-6"><i class="fas fa-arrow-left mr-2"></i>Volver al Menú</button>
            <section class="infographic-section">
                <h2><i class="fas fa-file-signature"></i>Generador de Contrato de Servicios</h2>
                <div class="input-group mb-6">
                    <label for="contract_monto">Monto del Contrato (Automático desde Escenario 1)</label>
                    <input type="number" id="contract_monto" placeholder="Se llena al calcular escenario 1" class="w-full" readonly>
                </div>

                <h3 class="subsection-title">Datos del Cliente (Contratante)</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                    <div class="input-group">
                        <label for="contract_cliente_nombre">Nombre Completo:</label>
                        <input type="text" id="contract_cliente_nombre" placeholder="Nombre(s) Apellido Paterno Apellido Materno" class="w-full">
                    </div>
                    <div class="input-group">
                        <label for="contract_cliente_telefono">Teléfono (10 dígitos):</label>
                        <input type="text" id="contract_cliente_telefono" placeholder="5512345678" maxlength="10" class="w-full">
                    </div>
                    <div class="input-group">
                        <label for="contract_cliente_email">Correo Electrónico:</label>
                        <input type="text" id="contract_cliente_email" placeholder="cliente@email.com" class="w-full">
                    </div>
                    <div class="input-group">
                        <label for="contract_cliente_direccion">Dirección Completa:</label>
                        <input type="text" id="contract_cliente_direccion" placeholder="Calle, Número, Colonia, Alcaldía, C.P., Ciudad" class="w-full">
                    </div>
                </div>

                <h3 class="subsection-title mt-8">Datos del Co-Contratante / Responsable Solidario</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                    <div class="input-group">
                        <label for="contract_rs_nombre">Nombre Completo:</label>
                        <input type="text" id="contract_rs_nombre" placeholder="Nombre(s) Apellido Paterno Apellido Materno" class="w-full">
                    </div>
                    <div class="input-group">
                        <label for="contract_rs_telefono">Teléfono (10 dígitos):</label>
                        <input type="text" id="contract_rs_telefono" placeholder="5587654321" maxlength="10" class="w-full">
                    </div>
                     <div class="input-group">
                         <label for="contract_rs_email">Correo Electrónico:</label>
                         <input type="text" id="contract_rs_email" placeholder="responsable@email.com" class="w-full">
                     </div>
                    <div class="input-group">
                        <label for="contract_rs_direccion">Dirección Completa:</label>
                        <input type="text" id="contract_rs_direccion" placeholder="Calle, Número, Colonia, Alcaldía, C.P., Ciudad" class="w-full">
                    </div>
                </div>

                <div class="text-center mt-10">
                    <button onclick="generateContractPDF()" class="btn btn-gold text-lg">
                        <i class="fas fa-file-pdf"></i>Generar y Descargar Contrato
                    </button>
                </div>
            </section>
        </div>

        <div id="crmSection" style="display: none;">
            <button onclick="showSection('mainMenuSection')" class="btn btn-secondary mb-6"><i class="fas fa-arrow-left mr-2"></i>Volver al Menú</button>
            <section class="infographic-section">
                <h2><i class="fas fa-users"></i>Cartera de Clientes</h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-2">Nombre Cliente</th>
                                <th class="p-2">Teléfono</th>
                                <th class="p-2">CURP</th>
                                <th class="p-2">Precio Venta</th>
                                <th class="p-2">Pensión Bruta</th>
                                <th class="p-2">Pensión Neta</th>
                                <th class="p-2">Meses M40</th>
                                <th class="p-2">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="clientsTableBody">
                            <tr><td colspan="8" class="text-center p-4">Cargando clientes...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <div id="adminSection" style="display: none;">
            <button onclick="showSection('mainMenuSection')" class="btn btn-secondary mb-6"><i class="fas fa-arrow-left mr-2"></i>Volver al Menú</button>
            <section class="infographic-section">
                <h2><i class="fas fa-user-shield"></i>Panel de Administrador</h2>
                
                <h3 class="subsection-title">Gestión de Acceso de Asesores</h3>
                <div class="overflow-x-auto max-h-96">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-gray-100 sticky top-0">
